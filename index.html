<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Math Sprint — Head-to-Head</title>
<style>
  :root{--bg:#0f1220;--panel:#161a2e;--ink:#e9ecf1;--muted:#aab3c5;--good:#38d39f;--bad:#ff6b6b;--warn:#ffb020;--chip:#232843}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:radial-gradient(1200px 800px at 10% -10%,#1b2142 0%,var(--bg) 55%);color:var(--ink);display:grid;place-items:start center}
  .wrap{width:min(1000px,96vw);margin:28px 0 56px}
  header{display:grid;gap:12px;grid-template-columns:1fr auto;align-items:start;margin-bottom:16px}
  h1{font-weight:800;margin:0;letter-spacing:.2px;font-size:clamp(20px,2.8vw,28px)}

  .controls{display:grid;gap:10px;padding:14px;background:color-mix(in oklab,var(--panel),#000 6%);border:1px solid #262b4a;border-radius:14px;grid-template-columns:repeat(8,minmax(0,1fr));align-items:end}
  .group{display:grid;gap:6px} label{font-size:12px;color:var(--muted);letter-spacing:.2px}
  select,input[type="range"],input[type="text"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2c335a;background:#0e1330;color:var(--ink);outline:none}
  .range-row{display:grid;grid-template-columns:1fr auto;align-items:center;gap:8px}
  .chip{background:var(--chip);border:1px solid #2b3155;border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)}

  /* Names full-width row with small avatar previews (players/) */
  .group.names{grid-column:1 / -1}
  .names-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .namebox{display:grid;grid-template-columns:auto 1fr;align-items:center;gap:8px}
  .name-avatar{width:32px;height:32px;border-radius:50%;object-fit:cover;border:1px solid #2b3155}
  #nameP1,#nameP2{min-width:220px;font-size:16px}

  .btn{appearance:none;border:1px solid #2c335a;background:linear-gradient(180deg,#1e2550,#141a3b);color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;letter-spacing:.2px;transition:transform .03s ease,filter .15s ease,border-color .15s ease}
  .btn:hover{filter:brightness(1.08);border-color:#3a4381} .btn:active{transform:translateY(1px) scale(.997)}
  .btn.ghost{background:#0e1330;color:var(--muted)} .btn.good{background:linear-gradient(180deg,#16553f,#103c2d);border-color:#1f6b4f;color:#d3ffe9}

  .grid{display:grid;grid-template-columns:3fr 2fr;gap:16px;align-items:stretch}
  .card{background:var(--panel);border:1px solid #262b4a;border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}

  .problem{display:grid;justify-items:center;align-content:center;gap:16px;background:radial-gradient(600px 340px at 50% -30%,#1a2150 0%,#121633 60%,#0f1329 100%);border-radius:12px;border:1px solid #262b4a;padding:16px}
  .formula{font-size:clamp(36px,6vw,64px);font-weight:800;letter-spacing:1px}

  .answer-rows{display:grid;gap:10px;width:min(560px,96%)}
  .row{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center}
  .row input{padding:12px 14px;border-radius:12px;border:1px solid #2c335a;outline:none;background:#0e1330;color:#fff;font-size:clamp(18px,2.2vw,22px);text-align:center;letter-spacing:.5px}
  .p1{border-left:4px solid #6bd3ff;padding-left:8px;border-radius:10px}
  .p2{border-left:4px solid #ffb86b;padding-left:8px;border-radius:10px}
  .avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;border:1px solid #2b3155}
  .hidden{display:none !important}

  .feedback{height:28px;font-weight:700;letter-spacing:.3px}
  .feedback.ok{color:var(--good)} .feedback.no{color:var(--bad)}

  .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px}
  .stat{background:#0e1330;border:1px solid #2b3155;border-radius:12px;padding:10px 12px;display:grid;gap:4px} .stat b{font-size:22px}

  .timer{display:grid;place-items:center;height:80px;background:#0e1330;border:1px solid #2b3155;border-radius:12px;font-weight:800;letter-spacing:.5px;font-size:28px}

  .fx-overlay{position:fixed;inset:0;display:grid;place-items:center;pointer-events:none;opacity:0;transition:opacity .25s ease;z-index:999}
  .fx-overlay.show{opacity:1}
  .fx-overlay img{max-width:min(60vmin,520px);max-height:70vh;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.55);border:2px solid #2b3155}

  /* Turn overlay */
  .turn-overlay{position:fixed;inset:0;background:rgba(5,8,20,.88);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity .2s ease}
  .turn-overlay.show{opacity:1;pointer-events:auto}
  .turn-card{background:var(--panel);border:1px solid #2b3155;border-radius:18px;padding:28px;display:grid;gap:14px;place-items:center;box-shadow:0 20px 60px rgba(0,0,0,.45)}
  .turn-card h2{margin:0;font-size:clamp(20px,3.2vw,28px)}
  .turn-avatar{width:min(22vmin,140px);height:min(22vmin,140px);border-radius:50%;object-fit:cover;border:2px solid #2b3155}

  footer{margin-top:14px;color:var(--muted);font-size:12px;display:flex;gap:12px;align-items:center}

  @media (max-width:860px){.controls{grid-template-columns:1fr 1fr}.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Math Sprint</h1>
      <div style="display:flex;gap:10px">
        <button id="btnStart" class="btn good">Start ▶</button>
        <button id="btnReset" class="btn ghost">Reset ⟲</button>
      </div>
    </header>

    <section class="controls">
      <div class="group">
        <label>Mode</label>
        <select id="mode">
          <option value="add">Add (+)</option>
          <option value="sub">Subtract (−)</option>
          <option value="mul">Multiply (×)</option>
          <option value="div">Divide (÷)</option>
          <option value="mix" selected>Mix</option>
        </select>
      </div>
      <div class="group">
        <label>Difficulty (1–10)</label>
        <div class="range-row">
          <input id="difficulty" type="range" min="1" max="10" value="3" />
          <span id="diffVal" class="chip">3</span>
        </div>
      </div>
      <div class="group">
        <label>Timer / Q (0=off)</label>
        <div class="range-row">
          <input id="timerSec" type="range" min="0" max="60" value="10" />
          <span id="timerVal" class="chip">10s</span>
        </div>
      </div>
      <div class="group">
        <label>Session length</label>
        <select id="maxQs"><option>10</option><option selected>20</option><option>30</option><option>50</option><option>∞</option></select>
      </div>
      <div class="group">
        <label>Players</label>
        <select id="players">
          <option value="1" selected>Single</option>
          <option value="2">Head-to-Head (2)</option>
        </select>
      </div>

      <!-- Names + small avatar previews -->
      <div class="group names">
        <label>Names</label>
        <div class="names-row">
          <div class="namebox">
            <img id="nameAvatarP1" class="name-avatar" src="players/p1.png" alt="P1" onerror="this.style.display='none'">
            <input id="nameP1" type="text" placeholder="Player 1" value="Player 1" />
          </div>
          <div class="namebox">
            <img id="nameAvatarP2" class="name-avatar" src="players/p2.png" alt="P2" onerror="this.style.display='none'">
            <input id="nameP2" type="text" placeholder="Player 2" value="Player 2" />
          </div>
        </div>
      </div>

      <div class="group">
        <label>Sound</label>
        <div class="range-row">
          <select id="soundOn"><option value="1" selected>On</option><option value="0">Off</option></select>
          <span class="chip">Vol</span>
        </div>
        <input id="volume" type="range" min="0" max="1" step="0.01" value="0.5" />
      </div>

      <div class="group">
        <label>&nbsp;</label>
        <span class="chip">Start turn: Space/Enter • Submit: Enter • Skip: S</span>
      </div>
    </section>

    <section class="grid" style="margin-top:16px">
      <div class="card">
        <div class="problem" id="problem">
          <div class="turn" id="turnBanner">—</div>
          <div id="formula" class="formula">—</div>

          <!-- single player -->
          <div id="singleRows" class="answer-rows" style="display:grid">
            <div class="row">
              <img id="soloAvatar" class="avatar hidden" alt="">
              <input id="answer1" class="p1" type="text" inputmode="numeric" placeholder="Your answer…" disabled />
              <button id="btnSubmit1" class="btn">Submit ⏎</button>
            </div>
          </div>

          <!-- multiplayer (only active row shown) -->
          <div id="multiRows" class="answer-rows" style="display:none">
            <div class="row" id="rowP1">
              <img id="avatarP1" class="avatar" src="players/p1.png" alt="P1" onerror="this.style.display='none'">
              <input id="answerP1" class="p1" type="text" inputmode="numeric" placeholder="P1…" disabled />
              <button id="btnSubmitP1" class="btn">Submit</button>
            </div>
            <div class="row" id="rowP2">
              <img id="avatarP2" class="avatar" src="players/p2.png" alt="P2" onerror="this.style.display='none'">
              <input id="answerP2" class="p2" type="text" inputmode="numeric" placeholder="P2…" disabled />
              <button id="btnSubmitP2" class="btn">Submit</button>
            </div>
          </div>

          <div id="feedback" class="feedback">&nbsp;</div>
        </div>

        <!-- global stats -->
        <div class="stats">
          <div class="stat"><label>Total Correct</label><b id="statGood">0</b></div>
          <div class="stat"><label>Total Incorrect</label><b id="statBad">0</b></div>
          <div class="stat"><label>Accuracy</label><b id="statAcc">—</b></div>
        </div>
        <!-- per-player stats -->
        <div id="versus" class="stats" style="display:none">
          <div class="stat"><label id="lblP1">P1 ✓ / ✗</label><b id="p1Score">0 / 0</b></div>
          <div class="stat"><label id="lblP2">P2 ✓ / ✗</label><b id="p2Score">0 / 0</b></div>
          <div class="stat"><label>Lead</label><b id="lead">—</b></div>
        </div>

        <footer>Shortcuts: Start turn (Space/Enter) • Submit (Enter) • Esc clear • S skip</footer>
      </div>

      <div class="card">
        <div class="timer" id="timer">Timer: off</div>
        <div class="stat" style="margin-top:12px"><label>Question</label><b id="qIndex">0</b></div>
        <div class="stat" style="margin-top:8px"><label>Streak</label><b id="streak">0</b></div>
        <div class="stat" style="margin-top:8px"><label>Best streak</label><b id="bestStreak">0</b></div>
        <div class="stat" style="margin-top:8px"><label>Last result</label><b id="lastResult">—</b></div>
      </div>
    </section>
  </div>

  <!-- overlays -->
  <div id="fxGood" class="fx-overlay"><img id="fxGoodImg" alt="Correct"></div>
  <div id="fxBad"  class="fx-overlay"><img id="fxBadImg"  alt="Incorrect"></div>

  <!-- Turn overlay -->
  <div id="turnOverlay" class="turn-overlay">
    <div class="turn-card">
      <img id="turnAvatar" class="turn-avatar" alt="">
      <h2 id="turnText">Next up: —</h2>
      <button id="btnBeginTurn" class="btn good">Start turn ▶</button>
      <div class="chip">or press Space / Enter</div>
    </div>
  </div>

<script>
(function(){
  // ===== DOM =====
  var $=function(s){return document.querySelector(s);}
  var elMode=$('#mode'), elDiff=$('#difficulty'), elDiffVal=$('#diffVal');
  var elTimerSec=$('#timerSec'), elTimerVal=$('#timerVal'), elMaxQs=$('#maxQs');
  var elPlayers=$('#players'), elNameP1=$('#nameP1'), elNameP2=$('#nameP2');

  var elSoundOn=$('#soundOn'), elVol=$('#volume');

  var elStart=$('#btnStart'), elReset=$('#btnReset');
  var elSingle=$('#singleRows'), elMulti=$('#multiRows');
  var elAns1=$('#answer1'), elBtn1=$('#btnSubmit1');
  var elP1=$('#answerP1'), elP2=$('#answerP2');
  var elBtnP1=$('#btnSubmitP1'), elBtnP2=$('#btnSubmitP2');
  var rowP1=$('#rowP1'), rowP2=$('#rowP2');

  var elFormula=$('#formula'), elFeedback=$('#feedback');
  var elStatGood=$('#statGood'), elStatBad=$('#statBad'), elStatAcc=$('#statAcc');
  var elQIndex=$('#qIndex'), elTimer=$('#timer'), elStreak=$('#streak'), elBest=$('#bestStreak'), elLast=$('#lastResult');
  var elVersus=$('#versus'), elP1Score=$('#p1Score'), elP2Score=$('#p2Score'), elLead=$('#lead');
  var elLblP1=$('#lblP1'), elLblP2=$('#
